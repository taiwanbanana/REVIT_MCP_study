# 自動安裝指令稿說明

此資料夾包含自動安裝 Revit MCP Add-in 的指令稿。

## 🔒 安全設計

這些指令稿經過安全審查，採用以下安全措施：

| 安全特性 | 說明 |
|---------|------|
| ✅ **本機檔案** | 只從本機複製檔案，**不會從網路下載** |
| ✅ **無管理員權限** | 不需要系統管理員權限（Add-in 資料夾在使用者目錄） |
| ✅ **路徑驗證** | 所有路徑經過驗證，防止路徑注入攻擊 |
| ✅ **結構驗證** | 執行前驗證專案目錄結構 |
| ✅ **使用者確認** | 安裝前會顯示來源/目標，等待使用者確認 |
| ✅ **檔案雜湊** | 顯示 SHA256 雜湊值供進階使用者驗證 |

## 包含的檔案

### 1. `install-addon.bat` (批次檔案)
- **適合對象**：大多數 Windows 使用者
- **使用方法**：雙擊執行即可
- **優點**：無需安裝額外軟體，執行最簡單

### 2. `install-addon.ps1` (PowerShell 指令稿)
- **適合對象**：進階使用者或需要更多控制的使用者
- **使用方法**：用 PowerShell 執行
- **優點**：提供更詳細的進度訊息和彩色輸出

## 使用步驟

### 方法 A：雙擊執行（最簡單）

1. **找到 `install-addon.bat` 檔案**
   - 在 Windows 檔案管理員中找到此檔案

2. **直接雙擊執行**
   - ⚠️ 不需要「以系統管理員身份執行」
   - 如果跳出安全警告，點擊「仍然執行」

3. **確認安裝**
   - 指令稿會顯示將要複製的檔案
   - 輸入 `Y` 確認安裝

4. **等待完成**
   - 看到「✓ 安裝完成！」訊息就代表成功
   - 按 Enter 關閉視窗

### 方法 B：用命令提示字元執行

1. **打開命令提示字元**
   - 按 `Win + R`
   - 輸入 `cmd`，按 Enter

2. **切換到指令稿所在的資料夾**
   ```cmd
   cd C:\path\to\REVIT_MCP_study\scripts
   ```

3. **執行安裝**
   ```cmd
   install-addon.bat
   ```

### 方法 C：用 PowerShell 執行

1. **打開 PowerShell**
   - 按 `Win + X`
   - 選擇「Windows PowerShell」
   - ⚠️ 不需要系統管理員權限

2. **設定執行策略（僅本次會話）**
   ```powershell
   Set-ExecutionPolicy -ExecutionPolicy Bypass -Scope Process
   ```
   - 出現確認時輸入 `Y`

3. **執行安裝**
   ```powershell
   cd C:\path\to\REVIT_MCP_study\scripts
   .\install-addon.ps1
   ```

## 指令稿會做什麼？

✓ **驗證專案目錄**
- 確認在正確的專案資料夾中執行
- 檢查 MCP 和 MCP-Server 資料夾是否存在

✓ **自動偵測 Revit 版本**
- 檢查您是否安裝了 Revit 2022、2023 或 2024
- 如果有多個版本，讓您選擇要安裝的版本

✓ **從本機複製檔案**
- RevitMCP.dll（主程式）- 從專案目錄複製
- RevitMCP.addin（配置檔案）- 從專案目錄複製
- Newtonsoft.Json.dll（如果存在）

✓ **安全檢查**
- 驗證所有路徑安全
- 顯示檔案雜湊值供驗證
- 等待使用者確認後才執行

✓ **錯誤處理**
- 如果找不到 Revit，會給出清楚的錯誤訊息
- 如果複製失敗，會說明可能的原因

## 常見問題

### Q: 執行時出現「拒絕存取」錯誤？
A: 
1. 關閉 Revit（檔案被佔用時無法複製）
2. 確認 Add-in 目錄沒有被其他程式鎖定
3. 如果仍有問題，嘗試用系統管理員身份執行

### Q: 找不到 Revit？
A:
1. 確認您安裝了 Revit 2022 / 2023 / 2024
2. 確認 Revit 已正確安裝在標準位置
3. 如果改過安裝位置，請參考 README.md 的手動安裝方式

### Q: 找不到 RevitMCP.dll？
A:
1. 請先製作程式（見主 README.md 的「步驟 1」）
2. 或從 GitHub Releases 下載現成版本
3. 將 DLL 放到 `MCP\MCP\bin\Release\` 資料夾

### Q: 看不到輸出訊息？
A:
- 確認您在 scripts 資料夾中執行指令稿
- 嘗試用命令提示字元執行（而不是雙擊）

### Q: 可以驗證檔案安全性嗎？
A: 可以！指令稿會顯示 SHA256 雜湊值，您可以比對官方發布的雜湊值

## 安裝後

1. **完全關閉 Revit**
2. **重新開啟 Revit**
3. **檢查功能區**
   - 應該會看到新的「MCP Tools」功能區
   - 裡面有「MCP 服務 (開/關)」按鈕
4. **測試**
   - 點擊「MCP 服務 (開/關)」
   - 應該看到 WebSocket 服務啟動的訊息

## 故障排除

如果安裝後 Revit 仍未顯示 MCP Tools：

1. **檢查安裝位置**
   ```
   %APPDATA%\Autodesk\Revit\Addins\2022  (或 2023/2024)
   ```
   - 應該看到 RevitMCP.dll 和 RevitMCP.addin

2. **檢查日誌**
   - 在 Revit 中點擊「幫助」→「檢查 Revit 日誌」
   - 搜尋 "RevitMCP" 查看是否有載入訊息

3. **嘗試手動安裝**
   - 參考 README.md 中的「方式 A - 選項 2」手動複製檔案

## 技術細節

### 批次檔案 (.bat)
- 使用 Windows 內建命令實現
- 支援自動偵測 Revit 版本
- 支援中文輸出（chcp 65001）
- 安全特性：路徑驗證、專案結構驗證、使用者確認

### PowerShell 指令稿 (.ps1)
- 更強大的功能和彩色輸出
- 更詳細的錯誤訊息
- 安全特性：Strict Mode、SHA256 雜湊、路徑注入防護

## 安全性說明

這些指令稿設計時考慮了以下安全原則：

1. **最小權限原則**：不需要系統管理員權限
2. **本機優先**：只處理本機檔案，不進行網路操作
3. **防禦性程式設計**：所有輸入都經過驗證
4. **透明度**：安裝前顯示完整的操作說明並等待確認

如果您對安全性有疑慮，可以：
- 閱讀指令稿原始碼（純文字檔案）
- 用文字編輯器檢查每一行命令
- 手動執行 README.md 中的安裝步驟

## 授權

這些指令稿屬於 REVIT_MCP_study 專案，遵循相同的 MIT 授權。

---

如有問題，請參考 README.md 或提交 Issue。
