name: 檢查 PR 只包含知識貢獻

on:
  pull_request:
    branches: [ main ]

jobs:
  check-files:
    runs-on: ubuntu-latest
    steps:
      - name: 檢查修改的檔案
        uses: actions/github-script@v7
        with:
          script: |
            const { data: files } = await github.rest.pulls.listFiles({
              owner: context.repo.owner,
              repo: context.repo.repo,
              pull_number: context.issue.number
            });
            
            const allowedPaths = ['domain/', 'GEMINI.md'];
            const invalidFiles = [];
            
            for (const file of files) {
              const isAllowed = allowedPaths.some(path => 
                file.filename.startsWith(path) || file.filename === path
              );
              if (!isAllowed) {
                invalidFiles.push(file.filename);
              }
            }
            
            if (invalidFiles.length > 0) {
              core.setFailed(
                `❌ PR 包含不允許的檔案修改：\n` +
                invalidFiles.map(f => `  - ${f}`).join('\n') + 
                `\n\n✅ 只允許修改：domain/*.md 和 GEMINI.md`
              );
            } else {
              console.log('✅ PR 只包含 domain/ 或 GEMINI.md 的變更，檢查通過！');
            }
